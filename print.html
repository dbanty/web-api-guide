<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Web API Guide</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Abstract Design</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Security</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="security/secure_defaults.html"><strong aria-hidden="true">1.1.</strong> Secure Defaults</a></li><li class="chapter-item expanded "><a href="security/threat_model.html"><strong aria-hidden="true">1.2.</strong> Threat Model</a></li><li class="chapter-item expanded "><a href="security/authentication.html"><strong aria-hidden="true">1.3.</strong> Authentication</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.4.</strong> Authorization</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Data Storage</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Documentation</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Testing</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Infrastructure</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Deployment</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Error Handling</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Logging</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Input Validation</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Correctness</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Maintenance</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Reference</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Web API Guide</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This guide is intended to serve as an opinionated, complete, end-to-end guide to creating an API on the web.</p>
<h2 id="why"><a class="header" href="#why">Why?</a></h2>
<p>There are a million or more guides on the internet for creating a web application. As far as I've seen, they're all focused around a specific technology choice rather than the principles of good design. They also tend to focus on getting started as quickly as possible while leaving out important details along the way, encouraging readers to skip the bits in later chapters which include things like authentication, testing, and documentation. I believe the prevalence of such guides and tutorials has, in no small way, contributed to the problems that exist on websites today such as:</p>
<ol>
<li>Undocumented, unversioned APIs leading to slow, stifled, error-ridden development.</li>
<li>Fuzzy boundaries between server and client, making cross site scripting and sluggish I/O harder to prevent.</li>
<li>Authorization, validation, and testing are afterthoughts and therefore often woefully inadequate.</li>
<li>Proper database management is left as an exercise for the reader, leading to slow, unstable web applications.</li>
</ol>
<h2 id="guiding-principles"><a class="header" href="#guiding-principles">Guiding Principles</a></h2>
<p>These statements are what drives the entire rest of the guide. If something doesn't adhere to all of these statements,
it doesn't belong here.</p>
<ol>
<li>The easy way should also be the right way.</li>
<li>Explicit is better than implicit.</li>
<li>Automatic is better than manual.</li>
</ol>
<h2 id="goals"><a class="header" href="#goals">Goals</a></h2>
<p>These are the things we're setting out to achieve with this guide:</p>
<ol>
<li>Provide general purpose, technology-agnostic guidance for building web APIs. Meaning the knowledge in this guide
should stay relevant even if the specific technologies recommended go out of fashion.</li>
<li>Recommend at least one, specific, end-to-end solution with complete tutorial.</li>
<li>If more than one option is recommended for any piece of the stack, provide clear guidance on when to select each one.</li>
</ol>
<h2 id="non-goals"><a class="header" href="#non-goals">Non Goals</a></h2>
<p>Things that this guide is not trying to achieve.</p>
<ol>
<li>A solution for every stack. If you've come to this guide having already made a decision about a programming language, cloud platform, or transport technology, you'll likely find this resource lacking. Any information here is intended to be derived from first principles without any preconceptions about or biases toward specific technology.</li>
<li>Solving the UI problem. Any recommendations we make for creating a great API must necessarily be easy to use from a UI, but we will not be recommending specific UI solutions here. There should probably be a guide like this one for web UIs, mobile apps, etc. but this isn't it.</li>
<li>Optimizing for anything other than developer experience and correctness. All other things being equal, we may recommend a solution which is faster, more flexible, cheaper, etc. but those things will be afterthoughts. If your goal is the fastest solution possible at the expense of everything else, you'll want to look elsewhere.</li>
<li>Creating a universal solution. The easier it is to do any one thing, the harder it will be to achieve corner cases. Because we're optimizing for developer experience and correctness in the most common scenarios, there will likely be specific use cases which are difficult to achieve. Again, we <em>may</em> include solutions for more specific problems (e.g. streaming video) but never at the expense of the more common ones.</li>
</ol>
<h2 id="whats-next"><a class="header" href="#whats-next">What's Next?</a></h2>
<p>The first section is the no compromises, unapologetic, idealistic section of the guide. Here we will dive into everything it takes to make a truly great web API without committing to any specific technologies or standards. The individual topics are presented in no particular order, <em>all</em> are important.</p>
<p>The point of this section is to serve as a sort of rubric for comparing available solutions when designing a new web API. The intention is that this section remains relatively static throughout the churn of technology by emphasizing design principles rather than specific problems and solutions. This section might also serve as general guidance for implementing a new solution, though further research will inevitably be required to turn these abstract ideas into something concrete.</p>
<h1 id="secure-defaults"><a class="header" href="#secure-defaults">Secure Defaults</a></h1>
<p>News story after news story has made it abundantly clear that offering security features is not enough, they <em>must</em> be enabled by default. Unfortunately security has taken a back seat to most other aspects of web development pretty consistently throughout the history of the internet. Typically, developers will only go out of their way to improve the security of their application when forced to by some external entity. This is why it is crucial that the developers of any internet-connected software ensure the <em>default</em> option for their users is <strong>the most secure one</strong>. When making the default secure is not plausible, efforts must be taken to lower the barrier to security for developers and encourage them to take necessary steps themselves.</p>
<p>It's impossible to cover all potential security features that need to have good defaults, but let's take a quick look at the <a href="https://en.wikipedia.org/wiki/STRIDE_%28security%29">STRIDE</a> mnemonic to get an idea of some examples. Each letter in &quot;STRIDE&quot; stands for a security threat to an application.</p>
<h2 id="s---spoofing"><a class="header" href="#s---spoofing">S - Spoofing</a></h2>
<p>Spoofing is the threat of impersonation. In most applications, it matters who or what is trying to perform a given action. As a result, any given API solution should default to having an <strong>enforced</strong> authentication mechanism in place that developers must specifically opt out of if they do not care about this threat. More about authentication can be found in <a href="security/authentication.html">the authentication section</a>.</p>
<h2 id="t---tampering"><a class="header" href="#t---tampering">T - Tampering</a></h2>
<p>Tampering is the threat of an unauthorized entity somehow modifying otherwise legitimate data. One example of this might be a &quot;monster in the middle&quot; attack where an attacker places themself in between a legitimate client of an API and the API service itself. The attacker can then modify the requests of the client before passing them along to the service to change the outcome. This problem, at the time of writing at least, doesn't have many great solutions. However, even an imperfect solution (such as <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">a header that protects users only <em>after</em> their first interaction</a>) should be enabled by default.</p>
<p>If such a solution becomes prohibitively difficult for development, the documentation for the solution should provide consumers with a way of <em>temporarily</em> disabling this protection which will only impact the development environment.</p>
<h2 id="r---repudiation"><a class="header" href="#r---repudiation">R - Repudiation</a></h2>
<p>Repudiation is the threat of lack of information. If a data breach or attack happens, it should be detectable and, as much as possible, traceable. To help prevent repudiation, any API solution must include sensible defaults for logging interactions with clear documentation for configuring verbosity (see <a href="security/../drafts/logging.html">the logging section</a> for more detail).</p>
<h2 id="i---information-disclosure"><a class="header" href="#i---information-disclosure">I - Information Disclosure</a></h2>
<p>Information disclosure is one of the broader threats to web applications, as it covers any situation in which information is leaked which could be harmful. This could be logging sensitive information to an insecure location (see <a href="security/../drafts/logging.html">the logging section</a> for more detail). It could also be providing too much information in an error response (see <a href="security/../drafts/error_handling.html">error handling</a>). <a href="security/authorization.html">Authorization</a> may be inadequate allowing users access to data they shouldn't be able to see.</p>
<p>A solution must make every effort to implement patterns and technologies that reduce the chance of information disclosure while also pointing out the potential risks to users. I suggest that creators of solutions go a step further and provide <a href="security/threat_model.html">a threat model</a> both to show the attack surface and threats to the solution in general and so that performing such a model on an application is <strong>easier for the developer</strong>. Furthermore, it's extremely important that a clear method of communication with consumers is established and that they are encouraged to follow it for security updates (see <a href="security/../drafts/maintenance.html">maintenance</a>).</p>
<h2 id="d---denial-of-service"><a class="header" href="#d---denial-of-service">D - Denial of Service</a></h2>
<p>Denial of service is the security perspective of stability. Common features that solutions require to mitigate this threat are scaling gracefully under load (see <a href="security/../drafts/infrastructure.html">infrastructure</a>) and preventing bugs from crippling the system (see <a href="security/../drafts/error_handling.html">error handling</a> and <a href="security/../drafts/correctness.html">correctness</a>).</p>
<h2 id="e---elevation-of-privilege"><a class="header" href="#e---elevation-of-privilege">E - Elevation of Privilege</a></h2>
<p>Elevation of privilege is specifically attempting to bypass any <a href="security/authorization.html">authorization</a> system which is in place. Solutions must provide an authorization system which is explicit to reduce the chance of under-securing and on by default to reduce the chance of failing to secure altogether. Additionally, solutions should use tools that prevent bypassing the authorization system altogether (see <a href="security/../drafts/correctness.html">correctness</a> and <a href="security/../drafts/maintenance.html">maintenance</a>).</p>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>The abstract examples above just barely scratch the surface of what is necessary to properly secure a web application. Security is a complex and difficult topic that teams of professionals can spend years working on and <em>still</em> miss things. This is why it's so critically important for security concepts to be enforced as far down the stack as possible and hardened by default. Only when something <em>cannot</em> be handled automatically should the developer be required to implement it themself, and the implementation should be as easy as possible, introduced early, and reinforced often. Finally, because the security landscape changes quickly and because it's so common to make mistakes, there <strong>must be clear, transparent, and accessible</strong> communication to consumers of any solution.</p>
<h1 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h1>
<p>Securing an application is hard. If it were easy, we wouldn't see the volume of breaches that we do today. As such, it is the responsibility of educators to provide developers with every tool possible to secure their application. Threat models, and an accompanying attack surface analysis, are one of the best tools we have today to achieve this.</p>
<p>If you are recommending a technology for use on the internet, you should be providing resources about that technology's security. If such resources don't exist, you shouldn't be recommending the technology. In my opinion, the best resource for describing the security of an application is a threat model.</p>
<p>Threat modeling is, in short, documenting the security risks and the mitigations to those risks for an application. If you want to learn about the practice in depth, I strongly recommend the <a href="https://threatmodelingbook.com">excellent book by Adam Shostack</a>. For the sake of completeness in this guide, I'll provide a brief overview of the key pieces here.</p>
<h2 id="data-flow-diagram"><a class="header" href="#data-flow-diagram">Data Flow Diagram</a></h2>
<p>A DFD may simultaneously be the most simple and most important piece of a threat model. Visualization of an application is invaluable when attempting to enumerate threats. Conveniently, a DFD will also be a useful educational tool to provide in a guide or <a href="security/../drafts/reference.html">reference material</a> for developers, making it all the more important to include.</p>
<p>The goal of a data flow diagram is to visualize all of the interactions that a web server might make with external entities. The attack surface of a running application is almost entirely comprised of the locations where data transfer happens, so that's what we're after. The exact format and layout of the DFD will depend on the technology you use to implement it, but an example might look something like this:</p>
<pre><code class="language-mermaid">    graph TD;
        API((My API))
        DB[(Database)]
        Consumer[API Consumer]
        Consumer &amp; Browser --&gt; API
        API --&gt; DB;
</code></pre>
<p>There are four distinct types of elements in a data flow diagram:</p>
<ol>
<li>A <strong>process</strong> is something running which you control. Generally this will be the main subject of the diagram. In the example, &quot;My API&quot; is a process.</li>
<li>An <strong>external entity</strong> is something that you don't control. In this case, &quot;API Consumer&quot; and &quot;Browser&quot; are external entitiesy.</li>
<li>A <strong>data store</strong> is a place that data is stored. The &quot;Database&quot; in the example.</li>
<li>A <strong>data flow</strong> is the connection between any two other elements. These are visualized as arrows in the example.</li>
</ol>
<p>It's important that the source of the provided data flow diagram be available to developers so that they can build on it to add their own elements. This source should be in a format that's easily accessible, not requiring any expensive tooling to build upon. Threat modeling is going to be a largely manual task, and the easier it is for developers to complete the more likely they are to do it.</p>
<h2 id="attack-surface-analysis"><a class="header" href="#attack-surface-analysis">Attack Surface Analysis</a></h2>
<p>The attack surface of an application is, broadly, anywhere that it interacts with other things. In the data flow diagram, each flow represents a portion of the attack surface. In order to allow, for example, a browser to speak to our application, our application must accept communication from the internet on some exposed port. The goal of an attack surface analysis is to look at all of these potential attack vectors in more detail.</p>
<p>For each attack vector, create documentation which describes where the code and infrastructure are that handle that interaction. This might be a description of the networking technology, firewall rules, <a href="security/authentication.html">authentication</a> and <a href="security/authorization.html">authorization</a>, or even <a href="security/../drafts/validation.html">validation</a>. The goal is to create a catalogue of specific components that should be analyzed for security threats. This information will also help guide the mindset for threat enumeration.</p>
<h2 id="threat-enumeration"><a class="header" href="#threat-enumeration">Threat Enumeration</a></h2>
<p>There are various ways to perform threat enumeration. My preference is to use STRIDE-per-interaction (no good reference for this yet) as it is extremely thorough, though time consuming. I then put each threat in a table with the risk level and any course of action we're going to take to mitigate that threat. However you go about enumerating and documenting threats, the key things to document are:</p>
<ol>
<li>A list of threats to each component of the system.</li>
<li>An indication of the risk of that threat.</li>
<li>A decision as to whether or not the threat will be mitigated.</li>
<li>Documentation describing the mitigation (once applied) or a status on the progress of the mitigation.</li>
</ol>
<p>Again, similar to the DFD, whatever format you present this threat enumeration in must be accessible and extensible. The goal is to provide a starting point for developers who are using a given solution to built on. Inevitably they will add more features which will increase the attack surface and lead to more threats.</p>
<h2 id="calls-to-action"><a class="header" href="#calls-to-action">Calls to Action</a></h2>
<p>A threat model is only as useful as it is accurate and relevant. Any guide to creating a web API which includes a base threat model must also tell developers how to use it. How can they take the base model and extend it with more detail? How can they adjust risk levels to their security requirements? What sorts of changes should trigger an update to this model?</p>
<h1 id="authentication"><a class="header" href="#authentication">Authentication</a></h1>
<p>Authentication is a critical part of most APIs, but is somehow also one of the most neglected. Authentication—and <a href="security/authorization.html">authorization</a>—are often left as exercises for the reader. At best, developers are given a half-baked solution and expected to find the rest of the information on their own. They might be directed toward some sort of token scheme but then not told how best to transport, store, or validate that token. Or told to use passwords without any information on the multitude of best practices one must follow to implement a secure password system.</p>
<p>As with everything in this guide, defaults and ease of use are key. Proper authentication is a problem that is very easy to get wrong and yet I have <em>never</em> seen a clear, end-to-end, simple guide to implementing it. Resources seem to go from the one extreme of ignore authentication altogether to the other—diving deep into the pros and cons of every available technology.</p>
<p>The average developer is not interested in spending days learning every possible variant of some authentication technique, they just need to secure their application. It's the job of the solution to provide <strong>a clear, concise, easy, and secure</strong> method of authentication. If more than one solution <em>can</em> be provided, then it should be, but the bare minimum is an opinionated, well-designed mechanism that requires minimal effort to implement.</p>
<p>The provided authentication mechanism(s) should be included in <a href="security/threat_model.html">the threat model</a> so the value that it is providing (along with any weaknesses) is clear.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="mermaid.min.js"></script>
        
        <script type="text/javascript" src="mermaid-init.js"></script>
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
