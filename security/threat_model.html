<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Threat Model - Web API Guide</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Abstract Design</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Security</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../security/secure_defaults.html"><strong aria-hidden="true">1.1.</strong> Secure Defaults</a></li><li class="chapter-item expanded "><a href="../security/threat_model.html" class="active"><strong aria-hidden="true">1.2.</strong> Threat Model</a></li><li class="chapter-item expanded "><a href="../security/authentication.html"><strong aria-hidden="true">1.3.</strong> Authentication</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.4.</strong> Authorization</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Data Storage</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Documentation</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Testing</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Infrastructure</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Deployment</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Error Handling</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Logging</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Input Validation</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Correctness</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Maintenance</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Reference</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Web API Guide</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h1>
<p>Securing an application is hard. If it were easy, we wouldn't see the volume of breaches that we do today. As such, it is the responsibility of educators to provide developers with every tool possible to secure their application. Threat models, and an accompanying attack surface analysis, are one of the best tools we have today to achieve this.</p>
<p>If you are recommending a technology for use on the internet, you should be providing resources about that technology's security. If such resources don't exist, you shouldn't be recommending the technology. In my opinion, the best resource for describing the security of an application is a threat model.</p>
<p>Threat modeling is, in short, documenting the security risks and the mitigations to those risks for an application. If you want to learn about the practice in depth, I strongly recommend the <a href="https://threatmodelingbook.com">excellent book by Adam Shostack</a>. For the sake of completeness in this guide, I'll provide a brief overview of the key pieces here.</p>
<h2 id="data-flow-diagram"><a class="header" href="#data-flow-diagram">Data Flow Diagram</a></h2>
<p>A DFD may simultaneously be the most simple and most important piece of a threat model. Visualization of an application is invaluable when attempting to enumerate threats. Conveniently, a DFD will also be a useful educational tool to provide in a guide or <a href="../drafts/reference.html">reference material</a> for developers, making it all the more important to include.</p>
<p>The goal of a data flow diagram is to visualize all of the interactions that a web server might make with external entities. The attack surface of a running application is almost entirely comprised of the locations where data transfer happens, so that's what we're after. The exact format and layout of the DFD will depend on the technology you use to implement it, but an example might look something like this:</p>
<pre class="mermaid">    graph TD;
        API((My API))
        DB[(Database)]
        Consumer[API Consumer]
        Consumer &amp; Browser --&gt; API
        API --&gt; DB;
</pre>
<p>There are four distinct types of elements in a data flow diagram:</p>
<ol>
<li>A <strong>process</strong> is something running which you control. Generally this will be the main subject of the diagram. In the example, &quot;My API&quot; is a process.</li>
<li>An <strong>external entity</strong> is something that you don't control. In this case, &quot;API Consumer&quot; and &quot;Browser&quot; are external entitiesy.</li>
<li>A <strong>data store</strong> is a place that data is stored. The &quot;Database&quot; in the example.</li>
<li>A <strong>data flow</strong> is the connection between any two other elements. These are visualized as arrows in the example.</li>
</ol>
<p>It's important that the source of the provided data flow diagram be available to developers so that they can build on it to add their own elements. This source should be in a format that's easily accessible, not requiring any expensive tooling to build upon. Threat modeling is going to be a largely manual task, and the easier it is for developers to complete the more likely they are to do it.</p>
<h2 id="attack-surface-analysis"><a class="header" href="#attack-surface-analysis">Attack Surface Analysis</a></h2>
<p>The attack surface of an application is, broadly, anywhere that it interacts with other things. In the data flow diagram, each flow represents a portion of the attack surface. In order to allow, for example, a browser to speak to our application, our application must accept communication from the internet on some exposed port. The goal of an attack surface analysis is to look at all of these potential attack vectors in more detail.</p>
<p>For each attack vector, create documentation which describes where the code and infrastructure are that handle that interaction. This might be a description of the networking technology, firewall rules, <a href="authentication.html">authentication</a> and <a href="authorization.html">authorization</a>, or even <a href="../drafts/validation.html">validation</a>. The goal is to create a catalogue of specific components that should be analyzed for security threats. This information will also help guide the mindset for threat enumeration.</p>
<h2 id="threat-enumeration"><a class="header" href="#threat-enumeration">Threat Enumeration</a></h2>
<p>There are various ways to perform threat enumeration. My preference is to use STRIDE-per-interaction (no good reference for this yet) as it is extremely thorough, though time consuming. I then put each threat in a table with the risk level and any course of action we're going to take to mitigate that threat. However you go about enumerating and documenting threats, the key things to document are:</p>
<ol>
<li>A list of threats to each component of the system.</li>
<li>An indication of the risk of that threat.</li>
<li>A decision as to whether or not the threat will be mitigated.</li>
<li>Documentation describing the mitigation (once applied) or a status on the progress of the mitigation.</li>
</ol>
<p>Again, similar to the DFD, whatever format you present this threat enumeration in must be accessible and extensible. The goal is to provide a starting point for developers who are using a given solution to built on. Inevitably they will add more features which will increase the attack surface and lead to more threats.</p>
<h2 id="calls-to-action"><a class="header" href="#calls-to-action">Calls to Action</a></h2>
<p>A threat model is only as useful as it is accurate and relevant. Any guide to creating a web API which includes a base threat model must also tell developers how to use it. How can they take the base model and extend it with more detail? How can they adjust risk levels to their security requirements? What sorts of changes should trigger an update to this model?</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../security/secure_defaults.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../security/authentication.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../security/secure_defaults.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../security/authentication.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../mermaid.min.js"></script>
        
        <script type="text/javascript" src="../mermaid-init.js"></script>
        

        

    </body>
</html>
